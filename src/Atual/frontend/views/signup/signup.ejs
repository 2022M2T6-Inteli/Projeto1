<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form method="post">
        <input type="text" required id="cnpj">
        <label for="cnpj">CNPJ</label><br>
        <input type="text" required id="razaoSoc">
        <label for="razaoSoc">Razão Social</label><br>
        <input type="text" required id="nomeFant">
        <label for="nomeFant">Nome Fantasia</label><br>
        <input type="number" required id="cnae">
        <label for="cnae">CNAE</label><br>
        <input type="number" required id="insc">
        <label for="insc">Número de inscrição</label><br>
        <input type="date" required id="dataAbert">
        <label for="dataAbert">Data de abertura</label><br>
        <input type="email" required id="email">
        <label for="email">E-Mail</label><br>
        <input type="text" required id="rua">
        <label for="rua">Rua</label><br>
        <input type="number" required id="n">
        <label for="n">N°</label><br>
        <input type="text" required id="bairro">
        <label for="bairro">Bairro</label><br>
        <select id="estados"><option value=""></option></select>
        <label for="estados">Estado</label><br>
        <select id="cidades"></select>
        <label for="cidades">Cidade</label><br>
        <input type="file" id="foto">
        <label for="foto">Foto</label><br>
        <input type="number" required id="func">
        <label for="func">Número de funcionários</label><br>
        <input type="text" required id="serv1">
        <label for="serv1">Serviço principal</label><br>
        <input type="text" required id="serv2">
        <label for="serv2">Serviço secundário</label><br>
        <input type="password" required id="pass">
        <label for="pass">Senha</label><br>
        <button onclick="submitProfile()">Entrar</button>
    </form>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script>
    function submitProfile(){
            const api = 'http://localhost:1234';
            let cnpj = $('#cnpj').val();
            let razaoSoc = $('#razaoSoc').val();
            let nomeFant = $('#nomeFant').val();
            let cnae = $('#cnae').val();
            let insc = $('#insc').val();
            let dataAbert = $('#dataAbert').val();
            let email = $('#email').val();
            let rua = $('#rua').val();
            let n = $('#n').val();
            let bairro = $('#bairro').val();
            let estados = $('#estados').val();
            let cidades = $('#cidades').val();
            let func = $('#func').val();
            let serv1 = $('#serv1').val();
            let serv2 = $('#serv2').val();
            $.ajax({
                type: "POST",
                url: api + "/cadastrar",
                data: {
                    cnpj: cnpj, 
                    razaoSoc: razaoSoc, 
                    nomeFant: nomeFant, 
                    cnae: cnae, 
                    insc: insc, 
                    dataAbert: dataAbert, 
                    email: email, 
                    rua: rua, 
                    n: n, 
                    bairro: bairro, 
                    estados: estados, 
                    cidades: cidades, 
                    func: func, 
                    serv1: serv1, 
                    serv2: serv2
                }
            }).done(function(){
                console.log('done');
            }).fail(function(){
                console.log('failed');
            }).always(function(){
                console.log('always');
            });
    };
    $(document).ready(function () {
        // Run states and cities function (Shoutout to ografael)
        $.getJSON('https://gist.githubusercontent.com/ografael/2037135/raw/5d31e7baaddd0d599b64c3ec04827fc244333447/estados_cidades.json', function (data) {
            var items = [];
            var options = '<option value="">Escolha um estado</option>';	

            $.each(data, function (key, val) {
                options += '<option value="' + val.nome + '">' + val.nome + '</option>';
            });					
            $("#estados").html(options);				
            
            $("#estados").change(function () {				
            
                var options_cidades = '';
                var str = "";					
                
                $("#estados option:selected").each(function () {
                    str += $(this).text();
                });
                
                $.each(data, function (key, val) {
                    if(val.nome == str) {							
                        $.each(val.cidades, function (key_city, val_city) {
                            options_cidades += '<option value="' + val_city + '">' + val_city + '</option>';
                        });							
                    }
                });

                $("#cidades").html(options_cidades);
                
            }).change();		
        });
    }); 
</script>
</html>

